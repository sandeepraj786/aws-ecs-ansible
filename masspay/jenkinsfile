pipeline{
    agent any
        stages{
            stage('SCM Checkout'){
                steps{
                    git 'https://github.com/sandeepraj786/aws-ecs-ansible.git'
                }
            }
            stage('passing the parameter'){
                steps{
                    script{
                        properties([
                            parameters([
                                string(name: 'action', defaultValue: "present", description: 'Resource provisioning and Resources deprovisioning '),
                            ])
                        ])
                    }
                }
            }
            stage('Resource provisioning'){
                steps{
                    script{
                        if (state==present){
                        sh "ansible-playbook /var/lib/jenkins/workspace/ecs-ansible-project/masspay/provision_ecs.yml --extra-vars 'state=${action}'"
                        sh "ansible-playbook /var/lib/jenkins/workspace/ecs-ansible-project/masspay/deploy_ecs.yml --extra-vars 'state=${action}'"

                        }
                    
                    }
                }
            }
            stage('Resource deprovisioning'){
                steps{
                    script{
                        if (state==absent){
                            sh "ansible-playbook /var/lib/jenkins/workspace/ecs-ansible-project/masspay/d1.yml --extra-vars 'state=${action}'"
                            sh "ansible-playbook /var/lib/jenkins/workspace/ecs-ansible-project/masspay/destroy_ecs.yml --extra-vars 'state=${action}'"

                        }
                        
                    }
                }
            }
        }
    
}